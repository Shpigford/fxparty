<header class="bg-white shadow">
  <div class="flex justify-between px-4 py-6 mx-auto max-w-7xl sm:px-6 lg:px-8">
    <h1 class="text-2xl font-bold text-gray-900">
    Tokens <span class="text-xs font-light text-gray-400 align-middle">NOTE: Super basic first pass at this page. Lots more in the works.</span>
    </h1>
  </div>
</header>

<main>
  <div class="py-6 mx-auto max-w-7xl sm:px-6 lg:px-8">
    <div class="flex flex-col">
      <div class="-my-2 sm:-mx-6 lg:-mx-8">
        <div class="py-2 align-middle sm:px-6 lg:px-8">
          

          <div class="overflow-hidden border-b border-gray-200 shadow sm:rounded-lg">
          <%= turbo_frame_tag "items" do %>
          <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200 table-fixed">
            <thead class="bg-gray-50">
              <tr>
                <th scope="col" class="sticky left-0 px-4 py-3 text-xs font-medium text-left text-gray-500 uppercase bg-gray-50 whitespace-nowrap">
                  <%= heading_link(nil, 'Token ID', 'id', 'number', params[:dir], params[:sort], 'token') %>
                </th>
                <th scope="col" class="px-4 py-3 text-xs font-medium text-left text-gray-500 uppercase number whitespace-nowrap">
                  <%= heading_link(nil, 'Token Name', 'name', 'text', params[:dir], params[:sort], 'token') %>
                </th>
                <th scope="col" class="px-4 py-3 text-xs font-medium text-left text-gray-500 uppercase number whitespace-nowrap">
                  <%= heading_link(nil, 'Artist', 'name', 'text', params[:dir], params[:sort], 'token') %>
                </th>
                <th scope="col" class="px-4 py-3 text-xs font-medium text-left text-gray-500 uppercase number whitespace-nowrap">
                  <%= heading_link(nil, 'Progress', 'balance', 'number', params[:dir], params[:sort], 'token') %>
                </th>
                <th scope="col" class="px-4 py-3 text-xs font-medium text-left text-gray-500 uppercase number whitespace-nowrap">
                  <%= heading_link(nil, 'Royalties', 'royalties', 'number', params[:dir], params[:sort], 'token') %>
                </th>
                <th scope="col" class="px-4 py-3 text-xs font-medium text-left text-gray-500 uppercase number whitespace-nowrap">
                  <%= heading_link(nil, 'Floor', 'floor', 'number', params[:dir], params[:sort], 'token') %>
                </th>
                <th scope="col" class="px-4 py-3 text-xs font-medium text-left text-gray-500 uppercase number whitespace-nowrap">
                  <%= heading_link(nil, 'Median', 'median', 'number', params[:dir], params[:sort], 'token') %>
                </th>
                <th scope="col" class="px-4 py-3 text-xs font-medium text-left text-gray-500 uppercase number whitespace-nowrap">
                  <%= heading_link(nil, '# Listings', 'total_listing', 'number', params[:dir], params[:sort], 'token') %>
                </th>
                <th scope="col" class="px-4 py-3 text-xs font-medium text-left text-gray-500 uppercase number whitespace-nowrap">
                  <%= heading_link(nil, 'Highest Sold', 'highest_sold', 'number', params[:dir], params[:sort], 'token') %>
                </th>
                <th scope="col" class="px-4 py-3 text-xs font-medium text-left text-gray-500 uppercase number whitespace-nowrap">
                  <%= heading_link(nil, 'Lowest Sold', 'lowest_sold', 'number', params[:dir], params[:sort], 'token') %>
                </th>
                <th scope="col" class="px-4 py-3 text-xs font-medium text-left text-gray-500 uppercase number whitespace-nowrap">
                  <%= heading_link(nil, 'Total Sales', 'prim_total', 'number', params[:dir], params[:sort], 'token') %>
                </th>
                <th scope="col" class="px-4 py-3 text-xs font-medium text-left text-gray-500 uppercase number whitespace-nowrap">
                  <%= heading_link(nil, '2nd Sales', 'sec_volume_tz', 'number', params[:dir], params[:sort], 'token') %>
                </th>
                <th scope="col" class="px-4 py-3 text-xs font-medium text-left text-gray-500 uppercase number whitespace-nowrap">
                  <%= heading_link(nil, '# Sales', 'sec_volume_nb', 'number', params[:dir], params[:sort], 'token') %>
                </th>
                <th scope="col" class="px-4 py-3 text-xs font-medium text-left text-gray-500 uppercase number whitespace-nowrap">
                  Avg Price (24)
                </th>
                <th scope="col" class="px-4 py-3 text-xs font-medium text-left text-gray-500 uppercase number whitespace-nowrap">
                  <%= heading_link(nil, '2nd Sales (24)', 'sec_volume_tz_24', 'number', params[:dir], params[:sort], 'token') %>
                </th>
                <th scope="col" class="px-4 py-3 text-xs font-medium text-left text-gray-500 uppercase number whitespace-nowrap">
                  <%= heading_link(nil, '# Sales (24)', 'sec_volume_tz_nb', 'number', params[:dir], params[:sort], 'token') %>
                </th>
              </tr>
            </thead>
              
            <tbody>
              <% @tokens.each do |token| %>
              <tr class="bg-white">
                <td class="absolute sticky left-0 max-w-xs px-4 py-4 text-sm text-gray-800 truncate bg-white border-r border-gray-200 whitespace-nowrap">
                  <%= link_to token.fxid, "https://www.fxhash.xyz/marketplace/generative/#{token.fxid}", class: 'text-blue-600 hover:text-blue-900' %>
                </td>
                <td class="px-4 py-4 text-sm text-gray-800 whitespace-nowrap bg-gradient-to-r from-gray-50 via-white to-white">
                  <%= link_to token.name, "https://www.fxhash.xyz/gentk/#{token.fxid}", class: 'text-blue-600 hover:text-blue-900' %>
                </td>
                <td class="px-4 py-4 text-sm text-gray-800 whitespace-nowrap">
                  <%= link_to token.author_name.to_s, "https://www.fxhash.xyz/pkh/#{token.author_address}" %>
                </td>
                <td class="px-4 py-4 text-sm text-gray-800 whitespace-nowrap">
                  <div class="flex">
                    <div class="w-24 h-1 mt-1 bg-gray-200">
                    <% 
                      progress_color = token.mint_progress.to_f >= 100 ? 'bg-green-500' : 'bg-blue-500'
                    %>
                      <div class="h-1 <%= progress_color %>" style="width: <%= token.mint_progress %>%"></div> 
                    </div> 
                    <div class="ml-2 text-xs text-gray-500">(<%= token.balance %>/<%= token.supply %>)</div>
                  </div>
                </td>
                 <td class="px-4 py-4 text-sm text-gray-800 whitespace-nowrap">
                  <%= (token.royalties.to_f / 10).to_s.sub(/\.?0+$/, '') %>%
                </td>
                <td class="px-4 py-4 text-sm text-gray-800 whitespace-nowrap">
                  <%= token.floor.present? ? display_tez(token.floor) : "<span class='text-gray-200'>—</span>".html_safe %>
                </td>
                <td class="px-4 py-4 text-sm text-gray-800 whitespace-nowrap">
                  <%= token.median.present? ? display_tez(token.median) : "<span class='text-gray-200'>—</span>".html_safe %>
                </td>
                <td class="px-4 py-4 text-sm text-gray-800 whitespace-nowrap">
                  <%= token.total_listing.present? ? token.total_listing.to_i : "<span class='text-gray-200'>—</span>".html_safe %>
                </td>
                <td class="px-4 py-4 text-sm text-gray-800 whitespace-nowrap">
                  <%= token.highest_sold.present? ? display_tez(token.highest_sold) : "<span class='text-gray-200'>—</span>".html_safe %>
                </td>
                <td class="px-4 py-4 text-sm text-gray-800 whitespace-nowrap">
                  <%= token.lowest_sold.present? ? display_tez(token.lowest_sold) : "<span class='text-gray-200'>—</span>".html_safe %>
                </td>
                <td class="px-4 py-4 text-sm text-gray-800 whitespace-nowrap">
                  <%= token.prim_total.present? ? display_tez(token.prim_total) : "<span class='text-gray-200'>—</span>".html_safe %>
                </td>
                <td class="px-4 py-4 text-sm text-gray-800 whitespace-nowrap">
                  <%= token.sec_volume_tz.present? ? display_tez(token.sec_volume_tz) : "<span class='text-gray-200'>—</span>".html_safe %>
                </td>
                <td class="px-4 py-4 text-sm text-gray-800 whitespace-nowrap">
                  <%= token.sec_volume_nb.present? ? token.sec_volume_nb.to_i : "<span class='text-gray-200'>—</span>".html_safe %>
                </td>
                <td class="px-4 py-4 text-sm text-gray-800 whitespace-nowrap">
                  <%= token.sec_volume_tz_24.to_i > 0 ? display_tez(token.sec_volume_tz_24.to_f / token.sec_volume_nb_24.to_f) : "<span class='text-gray-200'>—</span>".html_safe %>
                </td>
                <td class="px-4 py-4 text-sm text-gray-800 whitespace-nowrap">
                  <%= token.sec_volume_tz_24.present? ? display_tez(token.sec_volume_tz_24) : "<span class='text-gray-200'>—</span>".html_safe %>
                </td>
                <td class="px-4 py-4 text-sm text-gray-800 whitespace-nowrap">
                  <%= token.sec_volume_nb_24.present? ? token.sec_volume_nb_24.to_i : "<span class='text-gray-200'>—</span>".html_safe %>
                </td>
              </tr>
              <% end %>
            </tbody>
              
          </table>
          </div>
          <% end %>
          </div>
           
          
        </div>
      </div>
    </div>
  </div>
</main>